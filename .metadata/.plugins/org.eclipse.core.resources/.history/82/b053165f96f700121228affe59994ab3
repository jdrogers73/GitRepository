package edu.rogers.thekillersbattleborntour;

/*
 * This set of three classes will be used to receive the JSON string from Twitter's web server 
 * (which will be in byte form) and convert the string to character form
 */

import java.io.BufferedReader; 
/*
 * Provides a buffer to a reader;readers can read from files or streams. The data structure of a buffer 
 * is an array. When data is typically read from disk which must deal with 
 * the data in blocks. One or more blocks are copied into an array that has a capacity that is some 
 * multiple of the block size.Then, data from the buffer can be handled as individual bytes rather than 
 * entire blocks. Default buffer size is 8,192, but can be adjusted at instantiation
 */
import java.io.InputStream; 
/*
 * receives streams of data in byte form. source can be a file, a server, or a byte array. Byte arrays are 
 * generally used for low-level I/O, such as read/write buffers for files and networks, as graphics image 
 * buffers, and as "untyped" data streams.
 */
import java.io.InputStreamReader;
import java.net.URI;
import java.net.URISyntaxException;
import java.net.URL;
//purpose of input stream reader is to convert bytes to characters.

/*
 * The following bundle of classes are needed to communicate with Twitter's web server and process
 * its response.
 */
import org.apache.http.HttpEntity;
/*
 * An entity is a data object that can be processed by a content resolver and will contain the
 * JSON string.
 */
import org.apache.http.HttpResponse;
/*
 * This app will receive a response object from the server. The response will contain a status line
 * which contains a status code which indicates the outcome of the server's efforts to process the command.
 * The response also contains the entity.
 */
import org.apache.http.StatusLine;
/*
 * The status line is generated by the server and will include a status code for success/failure as well
 * as an entity.
 */
import org.apache.http.client.HttpClient;
/*
 * Interface for several subclasses of HTTP client classes; this app uses the the subclass
 * DefaultHttpClient.
 */
import org.apache.http.client.methods.HttpGet;
/*
 * This class contains various requests the client can make to the server. Will use a GET request
 * to get the 20 most recent posts to the Killers official feed
 */
import org.apache.http.impl.client.DefaultHttpClient;
/*
 * actually creates the HTTPClient
 */


//The following three classes are used in all Android apps
import android.app.Activity;
import android.os.Bundle;
import android.util.Log;

public class TwitterActivity extends Activity
{
	private String getTwitterPosts()
	{
		StringBuilder buildJSONString = new StringBuilder();
		//will construct the JSON string from contents of the entity returned from Twitter
		
		HttpClient client = new DefaultHttpClient();
		//create the client for communicating with Twitter webserver
		
		HttpGet getRequest = new HttpGet("https://api.twitter.com/1.1/statuses/user_timeline.json?screen_name=twitterapi&count=2");
		//The HTTP request that will instruct Twitter's web server to send The Killer's posts
		
		try
		{
			HttpResponse responseTwitter = client.execute(getRequest);
			StatusLine statusLineTwitter = responseTwitter.getStatusLine();
			int statusCode = statusLineTwitter.getStatusCode();
			
			if(statusCode == 200)
			{
				HttpEntity entity = responseTwitter.getEntity();
				InputStream iStream = entity.getContent();
				InputStreamReader iReader = new InputStreamReader(iStream);
				BufferedReader bReader = new BufferedReader(iReader);
			
				String jsonPart;
				while(bReader.readLine() != null)
				{
					jsonPart = bReader.readLine();
					buildJSONString.append(jsonPart);
				}
				bReader.close();
			}
			else
			{
				Log.d("JSON", "Failed to download JSON String");
			}
		}
		catch (Exception e)
		{
			Log.d("fromJSONFeed", e.getLocalizedMessage());
		}
		return buildJSONString.toString();
	}
		
    @Override
	protected void onCreate(Bundle savedInstanceState)
	{
		super.onCreate(savedInstanceState);
		setContentView(R.layout.layout_twitter);
		getTwitterPosts();
	}
}